services:
  dynamodb:
    image: amazon/dynamodb-local
    container_name: local-dynamodb
    hostname: dynamodb
    restart: always
    volumes:
      - dynamo_data:/home/dynamodblocal/data
    ports:
      - 8000:8000
    user: root # data folder is owned by root user - this is the simplest work-around
    command: '-jar DynamoDBLocal.jar -sharedDb -dbPath /home/dynamodblocal/data'

  mongodb:
    image: mongodb/mongodb-atlas-local:8.0
    container_name: local-mongodb
    hostname: mongodb
    restart: always
    volumes:
      - mongo_data:/data/db
      - mongo_conf:/data/configdb
    ports:
      - 27018:27017

  clickhouse-server:
    image: clickhouse/clickhouse-server:25.1.2
    container_name: local-clickhouse-server
    ports:
      - '8123:8123'
      - '9000:9000'
    volumes:
      - clickhouse_data:/var/lib/clickhouse-server
    privileged: true

  swagger-ui:
    image: swaggerapi/swagger-ui
    container_name: local-swagger-ui
    ports:
      - '8080:8080'
    environment:
      - SWAGGER_JSON=/openapi.yaml
      - SWAGGER_UI_PERSIST_AUTHORIZATION=true
      - SWAGGER_UI_WATCH=true # Enable auto-reload
      - QUERY_CONFIG_ENABLED=true
      - WITH_CREDENTIALS=true
      - PERSIST_AUTHORIZATION=true
      - CORS=true
      - CORS_ALLOWED_ORIGINS=*
      - CORS_ALLOW_CREDENTIALS=true
    volumes:
      - ./lib/openapi/internal/temp-merged-spec.yaml:/openapi.yaml:ro

volumes:
  dynamo_data:
  mongo_data:
  mongo_conf:
  clickhouse_data:
