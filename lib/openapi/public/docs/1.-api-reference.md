Flagright is a fully-managed, API-first compliance-as-a-service solution. All compliance related operations happen through the API and the Flagright Console no-code portal. Using Flagright allows you to manage a complex, high performance compliance system without investing in infrastructure or development resources.

The Flagright API is organized around REST. Our API has predictable resource-oriented URLs, accepts JSON-encoded request bodies, returns JSON-encoded responses, and uses standard HTTP response codes, authentication, and verbs.

All API requests must be made over HTTPS; calls made over plain HTTP will fail. API requests without authentication will also fail. API keys are used to authenticate the requests. Your API keys carry many privileges, so be sure to keep them secure! Do not share your secret API keys in publicly accessible areas such as GitHub, client-side code, and so forth.

## Entities and Relationships in the API

### User

This is an object representing a User that partakes in a transaction within your system. A User can be of type Business or Consumer. A consumer user is a individual that uses your product. Business users pertains to business using your services that result in a payment transaction.

For each user within your system, you send the user payload (KYC data and other user data) to the Flagright API through `POST /consumer/users` to create a consumer user and through `/business/users` to create a business user. You can call the API whenever there's a new user on your system or whenever a user updates their info on your system.

Each User is associated with a unique _userId_. You can pass in the internal userId along with your request and use that ID to query the user.

### Transaction

This is an object representing a Transaction within your system. On a high level, transaction is any event that results value (e.g. money) moving from one place to another. A transaction encapsulates value movement between different or same payment modes. This can be money moving from from a bank account to a digital wallet (DEPOSIT), money moving between two wallets, money moving from a wallet to a bank (withdrawal) or from one card to another.

The transaction entity primarily contains timestamp (UNIX timestamps in ms), data on ID of the user entity that is taking part in the transaction, origin & destination amounts and origin & destination payment details. The transaction enitity has also other optional fields such as transaction type, device metadata etc - [full payload](https://docs.flagright.com/docs/flagright-api/c2e087ee37bc9-verify-a-transaction#Request)

Each transaction is associated with a unique _transactionId_. You can pass in the internal `transactionId` along with your request and use that ID to query transaction. If no `transactionId` is provided, the Flagright system will create one for the transaction. It's usually a good idea to store this ID internally in case you need to retrieve it at a later stage.

For every transaction within your system, you send the transaction payload to Flagright API through the the verify transaction endpoint, `POST /transactions`, to verify whether the transaction is safe to process.

### Relationship between Users and Transactions

The transaction entity has the `originUserId` and `destinationUserId` fields that pertains to `userIds` of the users partaking in the transaction. The Transaction entity is linked to the user entity using these fields. If transaction is between two users within your system, then `originUserId` will be the `userId` of the using making the payment and `destinationUserId` will be the `userId` of the user destination the payment.

For transactions where only one side of the transaction is done by your users, you can leave either of the two fields blank. For example, for deposits, `originUserId` will be blank and for withdrawal, `destinationUserId` will be blank.

It's also possible to send in transaction payload without referencings users, this however, will limit the rules you can apply. Without referring `userId`s you will not be able to use rules that depend on user behaviour (e.g. data on past transactions).

### Transaction Event

Transaction Event entity encapsulates all the events that pertain to a transaction. The events generally pertain to a state change with respect to the status of the transaction. By default, calling the `POST /transactions` event to verify a transaction sets the status of the transaction as `CREATED`. Transaction events can be used to updated the status of the transaction and to provide additional data surrounding the transaction in it's lifecycle.

Each transaction event must has a associated transaction - referenced in the payload through `transactionId`. In addition, transaction event must also contain `eventType` that signals the status of the transaction and timestamp (UNIX timestamp in ms) of when the transaction event occured.

### Transaction Lifecycle through Transaction Events

In case you want to manage the transaction lifycycle - from `CREATED` to `SUCCESSFUL` - you can do so using transaction events. You do not need to manage this lifecycle and status if you want to use the transaction verification endpoint as a single idempotent request to check the transaction. The transaction status is transparent in our interface and is exposed only through transaction events for more sophisticated use cases.

When a transaction payload is passed to `POST /transactions`, by default status is set to `CREATED`. As the transaction is processed within your system, you can call the create transaction event endpoint `POST /events/transactions` to update the status of the transaction and provide additional data that resulted in status change. This status change will be reflected in the console for your operational teams to see.

## Use case: Digital Wallet

Let's take an example of a generic digital wallet to see how the Flagright API can be seamlessly used as the compliance and anti-fincrime infrastructure. For a generic wallet, there are three types of transactions:

1. **Deposit - User transfers money from external source (ex: Bank, credit card) to their wallet**

For deposits, the origin payment method is the external source, for example a SWIFT transfer and the destination payment method is the wallet type. In this case, the `originUserId` would be empty and the `destinationUserId` would be the userId of the user.

`originPaymentMethod` would contain information on the SWIFT transaction and the `destinationPaymentMethod` would contain payload for the wallet details on the user where the money is being deposited to.

You would make an API call to the `POST /transactions` to verify this transacation before processing, with the payload like so (Note: _You need an API Key to successfully make the below request, please reach out to us to get an API Key for sandbox_):

```json http
{
  "method": "post",
  "url": "https://sandbox.api.flagright.com/transactions",
  "body": {
    "transactionId": "7b80a539eea6e78acbd6d458e5971482",
    "type": "DEPOSIT",
    "destinationUserId": "9350a2611e0771cba03310f74bf6",
    "originAmountDetails": {
      "country": "DE",
      "transactionAmount": 800,
      "transactionCurrency": "EUR"
    },
    "destinationAmountDetails": {
      "country": "IN",
      "transactionAmount": 68351.34,
      "transactionCurrency": "INR"
    },
    "timestamp": 1641654664,
    "originPaymentDetails": {
      "method": "SWIFT",
      "swiftCode": "AAAABB11CC",
      "accountNumber": "32213423221",
      "accountType": "SAVINGS"
    },
    "destinationPaymentDetails": {
      "method": "WALLET",
      "walletId": "20ac00fed8ef913aefb17cfae1097cce"
    }
  }
}
```

2. **WITHDRAWAL - User transfers money from wallet to external source**

For withdrawal, the destination payment method is the external source, for example a SWIFT transfer and the origin payment method is the wallet type. In this case, the `originUserId` would be the userId of the user and the `destinationUserId` would be empty.

`originPaymentMethod` would contain information on the Wallet and the `destinationPaymentMethod` would contain payload for the SWIFT details on the user where the money is being withdrawn to.

You would make an API call to the `POST /transactions` to verify this transacation before processing, with the payload like so (Note: _You need an API Key to successfully make the below request, please reach out to us to get an API Key for sandbox_): :

```json http
{
  "method": "post",
  "url": "https://sandbox.api.flagright.com/transactions",
  "body": {
    "transactionId": "7b80a539eea6e78acbd6d458e5971482",
    "type": "DEPOSIT",
    "originUserId": "9350a2611e0771cba03310f74bf6",
    "originAmountDetails": {
      "country": "DE",
      "transactionAmount": 800,
      "transactionCurrency": "EUR"
    },
    "destinationAmountDetails": {
      "country": "IN",
      "transactionAmount": 68351.34,
      "transactionCurrency": "INR"
    },
    "timestamp": 1641654664,
    "originPaymentDetails": {
      "method": "WALLET",
      "walletId": "20ac00fed8ef913aefb17cfae1097cce"
    },
    "destinationPaymentDetails": {
      "method": "SWIFT",
      "swiftCode": "AAAABB11CC",
      "accountNumber": "32213423221",
      "accountType": "SAVINGS"
    }
  }
}
```

3. **Wallet to Wallet transfer between 2 users using the wallet service**

For peer-to-peer transfer, the destination payment method and the origin payment method are of wallet type. In this case, the `originUserId` would be the userId of the user making the payment and the `destinationUserId` would be the userId of the user receiving the payment.

Both `originPaymentMethod` and the `destinationPaymentMethod` would contain information on the Wallet. You would make an API call to the `POST /transactions` to verify this transacation before processing, with the payload like so (Note: _You need an API Key to successfully make the below request, please reach out to us to get an API Key for sandbox_):

```json http
{
  "method": "post",
  "url": "https://sandbox.api.flagright.com/transactions",
  "body": {
    "transactionId": "7b80a539eea6e78acbd6d458e5971482",
    "type": "DEPOSIT",
    "originUserId": "9350a2611e0771cba03310f74bf6",
    "originAmountDetails": {
      "country": "IN",
      "transactionAmount": 68351.34,
      "transactionCurrency": "INR"
    },
    "destinationAmountDetails": {
      "country": "IN",
      "transactionAmount": 68351.34,
      "transactionCurrency": "INR"
    },
    "timestamp": 1641654664,
    "originPaymentDetails": {
      "method": "WALLET",
      "walletId": "33ef69fed7ef123a171e3efae109791d"
    },
    "destinationPaymentDetails": {
      "method": "WALLET",
      "walletId": "20ac00fed8ef913aefb17cfae1097cce"
    }
  }
}
```
