#!/usr/bin/env ts-node
/* eslint-disable @typescript-eslint/no-explicit-any */

/**
 * This script injects AWS API Gateway specific settings into our public-device-data openapi and output to dist/openapi/openapi-public-device-data-autogenerated.yaml
 */

import * as fs from 'fs'
import * as yaml from 'js-yaml'
import _ from 'lodash'
import mkdirp from 'mkdirp'
import { StackConstants } from '../constants'
import { getAugmentedOpenapi } from './openapi-augmentor-util'

// We don't care about region
const env = (process.env.ENV || 'prod').split(':')[0]

export const PublicDeviceDataApiPathToLambda: any = {
  '/metric': StackConstants.PUBLIC_DEVICE_DATA_API_FUNCTION_NAME,
}

const openapi = getAugmentedOpenapi(
  './lib/openapi/public-device-data/openapi-public-device-data-original.yaml',
  PublicDeviceDataApiPathToLambda,
  'API_KEY'
)
mkdirp.sync(`./dist/openapi`)
fs.writeFileSync(
  `./dist/openapi/openapi-public-device-data-autogenerated-${env}.yaml`,
  yaml.dump(openapi)
)
